<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">ol{margin:0;padding:0}table td,table th{padding:0}.c13{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:56.4pt;border-top-color:#000000;border-bottom-style:solid}.c19{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:112.9pt;border-top-color:#000000;border-bottom-style:solid}.c16{background-color:#ffffff;color:#3d3d3d;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10.5pt;font-family:"Arial";font-style:normal}.c14{background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10.5pt;font-family:"Arial";font-style:normal}.c11{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Courier New";font-style:normal}.c9{padding-top:18pt;padding-bottom:6pt;line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.c26{padding-top:20pt;padding-bottom:6pt;line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.c15{padding-top:18pt;padding-bottom:6pt;line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:center}.c2{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c25{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:20pt;font-family:"Arial";font-style:normal}.c3{padding-top:0pt;padding-bottom:0pt;line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.c1{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:center;height:11pt}.c5{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:left;height:11pt}.c6{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:16pt;font-family:"Arial";font-style:normal}.c4{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:center}.c8{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c21{border-spacing:0;border-collapse:collapse;margin-right:auto}.c18{padding-top:0pt;padding-bottom:0pt;line-height:1.0;text-align:left}.c12{text-decoration-skip-ink:none;-webkit-text-decoration-skip:none;color:#1155cc;text-decoration:underline}.c24{margin-left:auto;border-spacing:0;border-collapse:collapse;margin-right:auto}.c20{background-color:#ffffff;font-size:10.5pt;color:#3d3d3d}.c7{background-color:#ffffff;max-width:451.4pt;padding:72pt 72pt 72pt 72pt}.c22{background-color:#ffffff;font-size:10.5pt}.c23{font-weight:400;font-family:"Courier New"}.c0{color:inherit;text-decoration:inherit}.c10{height:0pt}.c17{height:11pt}.title{padding-top:0pt;color:#000000;font-size:26pt;padding-bottom:3pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.subtitle{padding-top:0pt;color:#000000;font-size:11pt;padding-bottom:0pt;font-family:"Courier New";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:11pt;font-family:"Arial"}p{margin:0;color:#000000;font-size:11pt;font-family:"Arial"}h1{padding-top:20pt;color:#000000;font-size:20pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:18pt;color:#000000;font-size:16pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:16pt;color:#434343;font-size:14pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:14pt;color:#666666;font-size:12pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}</style></head><body class="c7"><h1 class="c26" id="h.cr2yrobgk5vk"><span class="c25">Visualising colour themes in popular movies using Clojure</span></h1><p class="c5"><span class="c2"></span></p><p class="c8"><span class="c2">Was it just me, or did the Harry Potter films get darker in tone as the kids got older? Let&#39;s find out. By taking each frame of each movie and compressing it down to 5x5 pixels and then averaging all of the frames (trimming the start and end to avoid credits) you can produce a single block colour:</span></p><p class="c1"><span class="c2"></span></p><a id="t.673a4eb875bfe578c9b6482dac6273eaaf48bd26"></a><a id="t.0"></a><table class="c24"><tbody><tr class="c10"><td class="c13" colspan="1" rowspan="1"><p class="c4"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 53.00px; height: 40.00px;"><img alt="" src="images/image27.jpg" style="width: 53.00px; height: 40.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c13" colspan="1" rowspan="1"><p class="c4"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 53.00px; height: 40.00px;"><img alt="" src="images/image14.jpg" style="width: 53.00px; height: 40.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c13" colspan="1" rowspan="1"><p class="c4"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 53.00px; height: 40.00px;"><img alt="" src="images/image22.jpg" style="width: 53.00px; height: 40.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c13" colspan="1" rowspan="1"><p class="c4"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 53.00px; height: 40.00px;"><img alt="" src="images/image25.jpg" style="width: 53.00px; height: 40.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c13" colspan="1" rowspan="1"><p class="c4"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 53.00px; height: 40.00px;"><img alt="" src="images/image29.jpg" style="width: 53.00px; height: 40.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c13" colspan="1" rowspan="1"><p class="c4"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 53.00px; height: 40.00px;"><img alt="" src="images/image33.jpg" style="width: 53.00px; height: 40.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c13" colspan="1" rowspan="1"><p class="c4"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 53.00px; height: 40.00px;"><img alt="" src="images/image8.jpg" style="width: 53.00px; height: 40.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c13" colspan="1" rowspan="1"><p class="c4"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 53.00px; height: 40.00px;"><img alt="" src="images/image19.jpg" style="width: 53.00px; height: 40.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td></tr><tr class="c10"><td class="c13" colspan="1" rowspan="1"><p class="c8"><span class="c12"><a class="c0" href="https://www.google.com/url?q=http://www.imdb.com/title/tt0241527/&amp;sa=D&amp;source=editors&amp;ust=1624292430842000&amp;usg=AOvVaw1ttgt-jl93ZFkPlAXPRYil">Harry Potter and the Philosopher&#39;s Stone (2001)</a></span></p></td><td class="c13" colspan="1" rowspan="1"><p class="c8"><span class="c12"><a class="c0" href="https://www.google.com/url?q=http://www.imdb.com/title/tt0295297/&amp;sa=D&amp;source=editors&amp;ust=1624292430843000&amp;usg=AOvVaw2ex6uU3wOvNnXqITY9qGpO">Harry Potter and the Chamber of Secrets (2002)</a></span></p></td><td class="c13" colspan="1" rowspan="1"><p class="c8"><span class="c12"><a class="c0" href="https://www.google.com/url?q=http://www.imdb.com/title/tt0304141/&amp;sa=D&amp;source=editors&amp;ust=1624292430843000&amp;usg=AOvVaw3LSnnv0RpJJOPp054huxKb">Harry Potter and the Prisoner of Azkaban (2004)</a></span></p></td><td class="c13" colspan="1" rowspan="1"><p class="c8"><span class="c12"><a class="c0" href="https://www.google.com/url?q=http://www.imdb.com/title/tt0330373/&amp;sa=D&amp;source=editors&amp;ust=1624292430844000&amp;usg=AOvVaw3HAzkmGYx0Cg7zwlixkOnm">Harry Potter and the Goblet of Fire (2005)</a></span></p></td><td class="c13" colspan="1" rowspan="1"><p class="c8"><span class="c12"><a class="c0" href="https://www.google.com/url?q=http://www.imdb.com/title/tt0373889/&amp;sa=D&amp;source=editors&amp;ust=1624292430845000&amp;usg=AOvVaw0khCn-utTHWmg8E4u_yUyE">Harry Potter and the Order of the Phoenix (2007)</a></span></p></td><td class="c13" colspan="1" rowspan="1"><p class="c8"><span class="c12"><a class="c0" href="https://www.google.com/url?q=http://www.imdb.com/title/tt0417741/&amp;sa=D&amp;source=editors&amp;ust=1624292430845000&amp;usg=AOvVaw1ZpcUF8wv3Q4O-HhyInhQ-">Harry Potter and the Half-Blood Prince (2009)</a></span></p></td><td class="c13" colspan="1" rowspan="1"><p class="c8"><span class="c12"><a class="c0" href="https://www.google.com/url?q=http://www.imdb.com/title/tt0926084/&amp;sa=D&amp;source=editors&amp;ust=1624292430846000&amp;usg=AOvVaw1NiEw1_0Xq9sgikRK9whcn">Harry Potter and the Deathly Hallows Part 1 (2010)</a></span></p></td><td class="c13" colspan="1" rowspan="1"><p class="c8"><span class="c12"><a class="c0" href="https://www.google.com/url?q=http://www.imdb.com/title/tt1201607/&amp;sa=D&amp;source=editors&amp;ust=1624292430846000&amp;usg=AOvVaw374-b8sLHDn-ZMgICOgIrY">Harry Potter and the Deathly Hallows Part 2 (2011)</a></span></p></td></tr></tbody></table><p class="c1"><span class="c2"></span></p><p class="c5"><span class="c2"></span></p><p class="c8"><span class="c2">Below is the series of images as an animated gif, with the films position in the series in the bottom right hand corner:</span></p><p class="c4"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 64.00px; height: 48.00px;"><img alt="" src="images/image9.gif" style="width: 64.00px; height: 48.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c1"><span class="c2"></span></p><p class="c8"><span>If you generate a composited image from </span><span>shrunk</span><span class="c2">en, averaged frames from the movie, and analyse it to calculate the average colour use for each film, you can show the overall darkening in tone as below:</span></p><p class="c1"><span class="c2"></span></p><p class="c4"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 567.12px; height: 263.50px;"><img alt="" src="images/image20.png" style="width: 567.12px; height: 263.50px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c1"><span class="c2"></span></p><p class="c1"><span class="c2"></span></p><p class="c4"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 573.00px; height: 250.00px;"><img alt="" src="images/image1.png" style="width: 573.00px; height: 250.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c1"><span class="c2"></span></p><p class="c8"><span class="c2">So, in summary, the films did get noticeably darker - there are certainly more browns and greens in the early movies, whereas the last two are over 50% &lsquo;dark&rsquo;. A more impressive series of images highlighting the transition is included later.</span></p><p class="c1"><span class="c2"></span></p><p class="c8"><span>It turns out I&rsquo;m not the first person to ask this question and, after a couple of weeks of work, I stumbled across a number of resources, including </span><span class="c12"><a class="c0" href="https://www.google.com/url?q=https://www.reddit.com/r/movies/comments/193s37/all_the_harry_potter_frames_from_all_the_movies/&amp;sa=D&amp;source=editors&amp;ust=1624292430848000&amp;usg=AOvVaw3Fc_D-92k-NpTtwe_fAxX9">this Reddit thread</a></span><span>&nbsp;basically achieving the same result. I&rsquo;ll walk you through my approach.</span></p><p class="c5"><span class="c2"></span></p><p class="c8"><span class="c2">Given a local copy of each movie converted to an MP4 format, we can extract each frame and visualise the changing colour palette each director chose to use as the films progress. The choice of colour palette tends to have a large impact on the &#39;mood&#39; of the film as perceived by the audience. As such, it is often a good proxy for the tone of the content.</span></p><h2 class="c9" id="h.r3ksmufort3p"><span class="c6">Capturing a single frame</span></h2><p class="c8"><span>When planning how to achieve these results I anticipated a fair amount of matrix manipulation, or conversion of sequences between formats, and so I chose to use Clojure. It helps that it&#39;s my language of choice anyway, and is used in my day job at uSwitch. The Java interop is an added bonus, particularly</span><span>&nbsp;as there are very</span><span>&nbsp;useful libraries out there</span><span>,</span><span>&nbsp;such as JavaCV (https://github.com/bytedeco/javacv)</span><span>,</span><span class="c2">&nbsp;which provides a suite of tools for image capture and manipulation.</span></p><p class="c5"><span class="c2"></span></p><p class="c8"><span class="c2">Below is an example which captures a single frame of video and returns it as a buffered image:</span></p><p class="c5"><span class="c11"></span></p><p class="c3 subtitle" id="h.ow7cix6j0wm6"><span class="c11">(import [org.bytedeco.javacv FFmpegFrameGrabber Java2DFrameConverter])</span></p><p class="c3 c17 subtitle" id="h.ow7cix6j0wm6-1"><span class="c11"></span></p><p class="c3 subtitle" id="h.ow7cix6j0wm6-2"><span class="c11">(defn buffered-image</span></p><p class="c3 subtitle" id="h.ow7cix6j0wm6-3"><span class="c11">&nbsp; [path]</span></p><p class="c3 subtitle" id="h.ow7cix6j0wm6-4"><span class="c11">&nbsp; (let [g (FFmpegFrameGrabber. path)</span></p><p class="c3 subtitle" id="h.ow7cix6j0wm6-5"><span class="c11">&nbsp; &nbsp; &nbsp; &nbsp; c (Java2DFrameConverter.)]</span></p><p class="c3 subtitle" id="h.ow7cix6j0wm6-6"><span class="c11">&nbsp; &nbsp; (.start g)</span></p><p class="c3 subtitle" id="h.ow7cix6j0wm6-7"><span class="c11">&nbsp; &nbsp; (.getBufferedImage c (.grab g))))</span></p><p class="c5"><span class="c2"></span></p><p class="c8"><span>As Java is typically stateful</span><span>,</span><span class="c2">&nbsp;we have to start and stop the FFmpegFrameGrabber to avoid memory overhead and to ensure resources are appropriately released. To abstract these steps away, we can write a macro to make working with image streams a little easier:</span></p><p class="c5"><span class="c2"></span></p><p class="c3 subtitle" id="h.neqsj4ma83s7"><span class="c11">(defmacro with-image-grabber</span></p><p class="c3 subtitle" id="h.neqsj4ma83s7-8"><span class="c11">&nbsp; [grabber-binding &amp; body]</span></p><p class="c3 subtitle" id="h.neqsj4ma83s7-9"><span class="c11">&nbsp; `(let ~(subvec grabber-binding 0 2)</span></p><p class="c3 subtitle" id="h.neqsj4ma83s7-10"><span class="c11">&nbsp; &nbsp; &nbsp;(do (.start ~(grabber-binding 0))</span></p><p class="c3 subtitle" id="h.neqsj4ma83s7-11"><span class="c11">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(let [result# ~@body]</span></p><p class="c3 subtitle" id="h.neqsj4ma83s7-12"><span class="c11">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(.stop ~(grabber-binding 0))</span></p><p class="c3 subtitle" id="h.neqsj4ma83s7-13"><span class="c11">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;result#))))</span></p><p class="c5"><span class="c2"></span></p><p class="c8"><span>This allows</span><span>&nbsp;us to invoke the image grabber as follows in this example</span><span>,</span><span class="c2">&nbsp;which returns the length of a video in frames:</span></p><p class="c5"><span class="c2"></span></p><p class="c3 subtitle" id="h.qh5x64gz1wvp"><span class="c11">(defn get-film-length</span></p><p class="c3 subtitle" id="h.qh5x64gz1wvp-14"><span class="c11">&nbsp; [film-path]</span></p><p class="c3 subtitle" id="h.qh5x64gz1wvp-15"><span class="c11">&nbsp; (image/with-image-grabber [g (FFmpegFrameGrabber. film-path)]</span></p><p class="c3 subtitle" id="h.qh5x64gz1wvp-16"><span class="c11">&nbsp; &nbsp; (.getLengthInFrames g)))</span></p><p class="c5"><span class="c2"></span></p><h2 class="c9" id="h.1odg8lmpbe6q"><span class="c6">Turning a frame into a pixel</span></h2><p class="c8"><span class="c2">My original plan was to iterate through each pixel in each frame, summing the colour components and then dividing by the size of the frame to calculate the average colour. It&rsquo;s relatively easy to get a byte array of pixel data from a BufferedImage:</span></p><p class="c5"><span class="c2"></span></p><p class="c3 subtitle" id="h.csiqf6ccyka"><span class="c11">(byte-array (.. buffered-image getRaster getDataBuffer getData))</span></p><p class="c5"><span class="c2"></span></p><p class="c8"><span class="c2">Each byte represents the value of a single colour channel of the image. Most images have 4 channels; red, blue, green and alpha. To determine whether or not an image includes an alpha channel, we can simply ask it:</span></p><p class="c5"><span class="c2"></span></p><p class="c3 subtitle" id="h.tu9hybbyrwka"><span class="c11">(not (nil? (.getAlphaRaster buffered-image)))</span></p><p class="c5"><span class="c2"></span></p><p class="c8"><span>If there is an alpha channel, each pixel will be represented by 4 bytes, allowing us to partition the byte array by pixel and to convert each pixel to a vector of integer colour values</span><span>:</span></p><p class="c5"><span class="c2"></span></p><p class="c3 subtitle" id="h.enrsd3y8dicl"><span class="c11">(defn byte-array-&gt;rgb</span></p><p class="c3 subtitle" id="h.4epdt09p7kg7"><span class="c11">&nbsp; [colours]</span></p><p class="c3 subtitle" id="h.mj5n44jn4h9k"><span class="c11">&nbsp; (reverse (map #(bit-and % 0xff) colours)))</span></p><p class="c3 c17 subtitle" id="h.xkcn4rxvb7rr"><span class="c11"></span></p><p class="c3 subtitle" id="h.9tsf0ddowl8m"><span class="c11">(defn bytes-&gt;rgb</span></p><p class="c3 subtitle" id="h.b528ezacou4"><span class="c11">&nbsp; [image-has-alpha? image-data-as-byte-array]</span></p><p class="c3 subtitle" id="h.xaxfm41qsqq3"><span class="c11">&nbsp; (let [partitioned-bytes &nbsp; (partition (if image-has-alpha? 4 3) image-data-as-byte-array)]</span></p><p class="c3 subtitle" id="h.k4svjmd5dx32"><span class="c11">&nbsp; &nbsp; (map byte-array-&gt;rgb partitioned-bytes)))</span></p><p class="c3 c17 subtitle" id="h.wya2oml057u"><span class="c11"></span></p><p class="c3 subtitle" id="h.1gzynqk2ass"><span class="c11">(defn buffered-image-&gt;int-array</span></p><p class="c3 subtitle" id="h.z4njuidfhu7w"><span class="c11">&nbsp; [buffered-image]</span></p><p class="c3 subtitle" id="h.rfgixe1325l7"><span class="c11">&nbsp; (let [image-data-as-byte-array (byte-array (.. buffered-image getRaster getDataBuffer getData))</span></p><p class="c3 subtitle" id="h.9r9iygf6k02y"><span class="c11">&nbsp; &nbsp; &nbsp; &nbsp; image-has-alpha? &nbsp; &nbsp; &nbsp; &nbsp; (not (nil? (.getAlphaRaster buffered-image)))]</span></p><p class="c3 subtitle" id="h.n3dfwoi1o74n"><span class="c11">&nbsp; &nbsp; (bytes-&gt;rgb image-has-alpha? image-data-as-byte-array)))</span></p><p class="c3 c17 subtitle" id="h.rcza7ssbu9xr"><span class="c11"></span></p><p class="c8"><span>This turns a colour, represented by Java as a 32</span><span>-</span><span>bit value into an array, such as [128 128 128 255], which represents this lovely pink colour</span><span>:</span></p><p class="c4"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 158.50px; height: 118.74px;"><img alt="" src="images/image18.jpg" style="width: 158.50px; height: 118.74px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c8"><span class="c2">&nbsp;</span></p><p class="c8"><span class="c2">To get an idea of the average (mean) colour of a frame, we would first calculate the int-array, and sum the values and then divide by the count:</span></p><p class="c5"><span class="c2"></span></p><p class="c3 subtitle" id="h.7fsee0jgeo3g"><span class="c11">(defn average-pixels</span></p><p class="c3 subtitle" id="h.7fsee0jgeo3g-17"><span class="c11">&nbsp; [pixel-values]</span></p><p class="c3 subtitle" id="h.7fsee0jgeo3g-18"><span class="c11">&nbsp; (let [pixel-count (double (count pixel-values))]</span></p><p class="c3 subtitle" id="h.7fsee0jgeo3g-19"><span class="c11">&nbsp; &nbsp; (map #(int (/ % pixel-count)) (apply (partial map +) pixel-values))))</span></p><p class="c5"><span class="c2"></span></p><p class="c8"><span class="c2">Being able to view the pixel values as ints in the range 0-255 made development easier but was clearly not the optimal way to calculate the average colour value. This process takes several seconds to complete. Given we&rsquo;d have to calculate this for every frame (24/second), assuming we could average 1 frame/second, we&rsquo;d be able to process about 60 seconds of material every 24 hours.</span></p><p class="c5"><span class="c2"></span></p><p class="c8"><span class="c2">I was about to investigate a more optimal algorithm when it occurred to me that what I was actually doing was resizing the image down to 1 pixel using averaging. After some exploration of the tooling already available, it turned out this is efficiently implemented already on the Graphics class, which exposes an editable component of the BufferedImage. The pixels are still averaged but in a much more efficient manner:</span></p><p class="c5"><span class="c2"></span></p><p class="c3 subtitle" id="h.2ux0fup6cbmm"><span class="c11">(defn create-tiled-image</span></p><p class="c3 subtitle" id="h.2ux0fup6cbmm-20"><span class="c11">&nbsp; [film-title film-path frames-to-capture scale-factor desired-width]</span></p><p class="c3 subtitle" id="h.2ux0fup6cbmm-21"><span class="c11">&nbsp; (image/with-image-grabber [g (FFmpegFrameGrabber. film-path)]</span></p><p class="c3 subtitle" id="h.2ux0fup6cbmm-22"><span class="c11">&nbsp; &nbsp; (let [new-image &nbsp; &nbsp; &nbsp; (image/new-image desired-final-width final-height)</span></p><p class="c3 subtitle" id="h.2ux0fup6cbmm-23"><span class="c11">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; new-image-graphics (.createGraphics new-image)]</span></p><p class="c3 subtitle" id="h.2ux0fup6cbmm-24"><span class="c11">&nbsp; &nbsp; &nbsp; (doseq [i (range frames-to-capture)]</span></p><p class="c3 subtitle" id="h.2ux0fup6cbmm-25"><span class="c11">&nbsp; &nbsp; &nbsp; &nbsp; (when-let [frame &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (get-next-frame-as-buffered-image g)]</span></p><p class="c3 subtitle" id="h.2ux0fup6cbmm-26"><span class="c11">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (let [[x-offset y-offset] (calculate-offset i scale-factor desired-width)]</span></p><p class="c3 subtitle" id="h.2ux0fup6cbmm-27"><span class="c11">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (.drawImage new-image-graphics frame x-offset y-offset scale-factor scale-factor nil))))</span></p><p class="c3 subtitle" id="h.2ux0fup6cbmm-28"><span class="c11">&nbsp; &nbsp; &nbsp; (.dispose new-image-graphics)</span></p><p class="c3 subtitle" id="h.2ux0fup6cbmm-29"><span class="c11">&nbsp; &nbsp; &nbsp; (write-image new-image film-title scale-factor))))</span></p><p class="c5"><span class="c2"></span></p><p class="c8"><span>There&rsquo;s quite a lot going on in this beefy function, but the key part is that given a </span><span class="c23">graphics</span><span class="c2">&nbsp;component of a BufferedImage, we can draw a different image to x and y coordinates, scaled to a height and width as follows:</span></p><p class="c5"><span class="c2"></span></p><p class="c3 subtitle" id="h.78g7izh0y44n"><span class="c11">(.drawImage new-image-graphics frame x-offset y-offset scale-factor scale-factor nil)</span></p><p class="c5"><span class="c2"></span></p><p class="c8"><span>Be resizing each frame to </span><span>1</span><span>&nbsp;pixel and tiling them, we can produce an image like below, which shows </span><span class="c12"><a class="c0" href="https://www.google.com/url?q=http://www.imdb.com/title/tt1074638/&amp;sa=D&amp;source=editors&amp;ust=1624292430869000&amp;usg=AOvVaw226AWy1g_CiIGItIqOyCKu">Skyfall (2012)</a></span><span>:</span><span>&nbsp;</span></p><h2 class="c9" id="h.7phdtkseenby"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 601.70px; height: 73.33px;"><img alt="" src="images/image13.png" style="width: 601.70px; height: 73.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></h2><h2 class="c9" id="h.87dm3ytmz6yf"><span class="c6">Scaling Mechanism</span></h2><p class="c8"><span>Java provides a number of mechanisms for scaling an image based on your priorities - most of the time</span><span>,</span><span class="c2">&nbsp;the key decision is performance vs &lsquo;quality&rsquo; for some definition of quality, which is usually centred on how much of the image is discarded when scaling down or how interpolation works when scaling up.</span></p><p class="c5"><span class="c2"></span></p><p class="c8"><span class="c2">Fast image scaling is usually achieved using a nearest neighbour algorithm (http://tech-algorithm.com/articles/nearest-neighbor-image-scaling/); additional blank pixels are added between the existing pixels and the colour of the pixel nearest each blank pixel is copied over:</span></p><p class="c5"><span class="c2"></span></p><p class="c8"><span class="c2">Below is an example of an image scaled up using the nearest neighbour algorithm</span></p><p class="c8"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 196.00px; height: 196.00px;"><img alt="" src="images/image5.jpg" style="width: 196.00px; height: 196.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c8"><span class="c2">Original image</span></p><p class="c5"><span class="c2"></span></p><p class="c8"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 392.00px; height: 392.00px;"><img alt="" src="images/image16.png" style="width: 392.00px; height: 392.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c8"><span class="c2">Scaled x 2</span></p><p class="c5"><span class="c2"></span></p><p class="c8"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 601.70px; height: 601.33px;"><img alt="" src="images/image28.png" style="width: 601.70px; height: 601.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c8"><span class="c2">Scaled x4</span></p><p class="c5"><span class="c2"></span></p><p class="c8"><span>This leads to relatively decent results although jagged artifacts are obvious, particularly on curved edges. An image with a wider range of colour would also end up looking &lsquo;blockier&rsquo;</span><span>.</span></p><p class="c5"><span class="c2"></span></p><p class="c8"><span>What&rsquo;s more interesting for our purposes is seeing what happens when the image is scaled down</span><span>:</span></p><p class="c5"><span class="c2"></span></p><p class="c8"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 196.00px; height: 196.00px;"><img alt="" src="images/image5.jpg" style="width: 196.00px; height: 196.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c5"><span class="c2"></span></p><p class="c8"><span class="c2">Original image</span></p><p class="c5"><span class="c2"></span></p><p class="c8"><span>&nbsp;</span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 98.00px; height: 98.00px;"><img alt="" src="images/image26.png" style="width: 98.00px; height: 98.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c8"><span class="c2">Scaled x 0.5</span></p><p class="c8"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 49.00px; height: 49.00px;"><img alt="" src="images/image11.png" style="width: 49.00px; height: 49.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c8"><span class="c2">Scaled x 0.25</span></p><p class="c5"><span class="c2"></span></p><p class="c8"><span>There are a number of alternative image</span><span>-</span><span class="c2">scaling techniques which interpolate the pixel data in a variety of ways. The most common (and default options in the Java graphics class) are bicubic (http://blog.demofox.org/2015/08/15/resizing-images-with-bicubic-interpolation/) and bilinear (http://tech-algorithm.com/articles/bilinear-image-scaling/). Below is a comparison of the results of scaling the original image down through each different method:</span></p><p class="c5"><span class="c2"></span></p><p class="c5"><span class="c2"></span></p><a id="t.bf2cf318122b2f22956484c9c92b2f48c8432a85"></a><a id="t.1"></a><table class="c21"><tbody><tr class="c10"><td class="c19" colspan="1" rowspan="1"><p class="c8"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 135.00px; height: 134.67px;"><img alt="" src="images/image5.jpg" style="width: 135.00px; height: 134.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c19" colspan="1" rowspan="1"><p class="c18"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 49.00px; height: 49.00px;"><img alt="" src="images/image11.png" style="width: 49.00px; height: 49.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c19" colspan="1" rowspan="1"><p class="c18"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 49.00px; height: 49.00px;"><img alt="" src="images/image4.png" style="width: 49.00px; height: 49.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c19" colspan="1" rowspan="1"><p class="c18"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 49.00px; height: 49.00px;"><img alt="" src="images/image6.png" style="width: 49.00px; height: 49.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td></tr><tr class="c10"><td class="c19" colspan="1" rowspan="1"><p class="c18"><span class="c2">Original Image</span></p></td><td class="c19" colspan="1" rowspan="1"><p class="c18"><span class="c2">Scaled x 0.25 using nearest neighbour</span></p></td><td class="c19" colspan="1" rowspan="1"><p class="c18"><span class="c2">Scaled x 0.25 using bilinear interpolation</span></p></td><td class="c19" colspan="1" rowspan="1"><p class="c18"><span class="c2">Scaled x 0.25 using bicubic interpolation</span></p></td></tr></tbody></table><p class="c5"><span class="c2"></span></p><p class="c5"><span class="c2"></span></p><p class="c5"><span class="c2"></span></p><p class="c5"><span class="c2"></span></p><p class="c5"><span class="c2"></span></p><p class="c8"><span>This excellent article (https://community.oracle.com/docs/DOC-983611) provides detail of the different options available for scaling.</span><span class="c20">&nbsp;</span><span class="c22">The method of scaling can be </span><span class="c22">trivially achieved</span><span class="c14">&nbsp;using the .setRenderingHints method on the Graphics class, meaning we could write something as follows to scale images up or down in Clojure using bilinear interpolation:</span></p><p class="c5"><span class="c14"></span></p><p class="c3 subtitle" id="h.m5iqy3sgnhfg"><span class="c11">(defn scale-image</span></p><p class="c3 subtitle" id="h.m5iqy3sgnhfg-30"><span class="c11">&nbsp; [graphics image-to-scale scaled-width scaled-height]</span></p><p class="c3 subtitle" id="h.m5iqy3sgnhfg-31"><span class="c11">&nbsp; (.drawImage graphics image-to-scale 0 0 scaled-width scaled-height nil))</span></p><p class="c3 c17 subtitle" id="h.m5iqy3sgnhfg-32"><span class="c11"></span></p><p class="c3 subtitle" id="h.m5iqy3sgnhfg-33"><span class="c11">(defn resize-image</span></p><p class="c3 subtitle" id="h.m5iqy3sgnhfg-34"><span class="c11">&nbsp; [path scale-factor]</span></p><p class="c3 subtitle" id="h.m5iqy3sgnhfg-35"><span class="c11">&nbsp; (let [i &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(read-image path)</span></p><p class="c3 subtitle" id="h.m5iqy3sgnhfg-36"><span class="c11">&nbsp; &nbsp; &nbsp; &nbsp; new-width &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(* scale-factor (.getWidth i))</span></p><p class="c3 subtitle" id="h.m5iqy3sgnhfg-37"><span class="c11">&nbsp; &nbsp; &nbsp; &nbsp; new-height &nbsp; &nbsp; &nbsp; &nbsp; (* scale-factor (.getHeight i))</span></p><p class="c3 subtitle" id="h.m5iqy3sgnhfg-38"><span class="c11">&nbsp; &nbsp; &nbsp; &nbsp; new-image &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(image/new-image new-width new-height)</span></p><p class="c3 subtitle" id="h.m5iqy3sgnhfg-39"><span class="c11">&nbsp; &nbsp; &nbsp; &nbsp; new-image-graphics (.createGraphics new-image)]</span></p><p class="c3 subtitle" id="h.m5iqy3sgnhfg-40"><span class="c11">&nbsp; &nbsp; (.setRenderingHint new-image-graphics RenderingHints/KEY_INTERPOLATION RenderingHints/VALUE_INTERPOLATION_BILINEAR)</span></p><p class="c3 subtitle" id="h.m5iqy3sgnhfg-41"><span class="c11">&nbsp; &nbsp; (.setRenderingHint new-image-graphics RenderingHints/KEY_RENDERING RenderingHints/VALUE_RENDER_QUALITY)</span></p><p class="c3 subtitle" id="h.m5iqy3sgnhfg-42"><span class="c11">&nbsp; &nbsp; (scale-image new-image-graphics i new-width new-height)</span></p><p class="c3 subtitle" id="h.m5iqy3sgnhfg-43"><span class="c11">&nbsp; &nbsp; (.dispose new-image-graphics)</span></p><p class="c3 subtitle" id="h.m5iqy3sgnhfg-44"><span class="c11">&nbsp; &nbsp; (image/write-image new-image)))</span></p><p class="c5"><span class="c16"></span></p><h2 class="c9" id="h.ap0h87xxkjuz"><span class="c6">Increasing the size of each pixel</span></h2><p class="c8"><span>My next thought was to see if I could generate more impressive images by resizing each frame to a small 5x5 size, retaining a small amount of the detail of the initial frame. After experimenting with the different scaling hints possible</span><span>,</span><span>&nbsp;and after doing some research</span><span>,</span><span>&nbsp;I came across a number of users pointing me to the </span><span>Thumbnailinator</span><span class="c2">&nbsp;library (http://tech-algorithm.com/articles/nearest-neighbor-image-scaling/), which abstracts the action of choosing an optimal algorithm away from the user based on the size of the desired final image.</span></p><p class="c5"><span class="c2"></span></p><p class="c8"><span class="c2">Integration was relatively easy, and our create-tiled-image function doesn&rsquo;t actually need to change that much:</span></p><p class="c5"><span class="c2"></span></p><p class="c3 subtitle" id="h.eaxhfwace95v"><span class="c11">(defn create-tiled-image</span></p><p class="c3 subtitle" id="h.eaxhfwace95v-45"><span class="c11">&nbsp; [film-title film-path frames-to-capture scale-factor desired-final-width]</span></p><p class="c3 subtitle" id="h.eaxhfwace95v-46"><span class="c11">&nbsp; (image/with-image-grabber [g (FFmpegFrameGrabber. film-path)]</span></p><p class="c3 subtitle" id="h.eaxhfwace95v-47"><span class="c11">&nbsp; &nbsp; (let [thumbnail-maker (image/get-thumbnail-maker g scale-factor)</span></p><p class="c3 subtitle" id="h.eaxhfwace95v-48"><span class="c11">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; new-image &nbsp; &nbsp; &nbsp; (image/new-image desired-final-width final-height)</span></p><p class="c3 subtitle" id="h.eaxhfwace95v-49"><span class="c11">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; new-image-graphics (.createGraphics new-image)]</span></p><p class="c3 subtitle" id="h.eaxhfwace95v-50"><span class="c11">&nbsp; &nbsp; &nbsp; (doseq [i (range frames-to-capture)]</span></p><p class="c3 subtitle" id="h.eaxhfwace95v-51"><span class="c11">&nbsp; &nbsp; &nbsp; &nbsp; (when-let [frame &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (get-next-frame-as-buffered-image g)]</span></p><p class="c3 subtitle" id="h.eaxhfwace95v-52"><span class="c11">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (let [resized-image &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(image/scale-image thumbnail-maker frame)</span></p><p class="c3 subtitle" id="h.eaxhfwace95v-53"><span class="c11">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [x-offset y-offset] (calculate-offset i scaled-width scaled-height desired-final-width)]</span></p><p class="c3 subtitle" id="h.eaxhfwace95v-54"><span class="c11">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (.drawImage new-image-graphics resized-image x-offset y-offset nil))))</span></p><p class="c3 subtitle" id="h.eaxhfwace95v-55"><span class="c11">&nbsp; &nbsp; &nbsp; (. new-image-graphics dispose)</span></p><p class="c3 subtitle" id="h.eaxhfwace95v-56"><span class="c11">&nbsp; &nbsp; &nbsp; (image/write-image new-image film-title scale-factor))))</span></p><p class="c5"><span class="c2"></span></p><p class="c8"><span class="c2">And here are the appropriate parts of the image namespace:</span></p><p class="c5"><span class="c2"></span></p><p class="c3 subtitle" id="h.idb5ynlt7ezb"><span class="c11">(defn dimension</span></p><p class="c3 subtitle" id="h.idb5ynlt7ezb-57"><span class="c11">&nbsp; [width height]</span></p><p class="c3 subtitle" id="h.idb5ynlt7ezb-58"><span class="c11">&nbsp; (Dimension. width height))</span></p><p class="c3 c17 subtitle" id="h.idb5ynlt7ezb-59"><span class="c11"></span></p><p class="c3 subtitle" id="h.idb5ynlt7ezb-60"><span class="c11">(defn- get-resizer</span></p><p class="c3 subtitle" id="h.idb5ynlt7ezb-61"><span class="c11">&nbsp; [image-width image-height intended-width intended-height]</span></p><p class="c3 subtitle" id="h.idb5ynlt7ezb-62"><span class="c11">&nbsp; (. (DefaultResizerFactory/getInstance)</span></p><p class="c3 subtitle" id="h.xw0c7rib4la"><span class="c11">&nbsp; &nbsp; &nbsp;getResizer (dimension image-width image-height) (dimension intended-width intended-height)))</span></p><p class="c5"><span class="c2"></span></p><p class="c3 subtitle" id="h.1vy8qtd2o2tt"><span class="c11">(defn frame-dimensions</span></p><p class="c3 subtitle" id="h.1vy8qtd2o2tt-63"><span class="c11">&nbsp; [grabber]</span></p><p class="c3 subtitle" id="h.1vy8qtd2o2tt-64"><span class="c11">&nbsp; [(.getImageWidth grabber) (.getImageHeight grabber)])</span></p><p class="c3 c17 subtitle" id="h.1vy8qtd2o2tt-65"><span class="c11"></span></p><p class="c3 subtitle" id="h.1vy8qtd2o2tt-66"><span class="c11">(defn scale-preserving-aspect-ratio</span></p><p class="c3 subtitle" id="h.1vy8qtd2o2tt-67"><span class="c11">&nbsp; [image-width image-height scaled-width]</span></p><p class="c3 subtitle" id="h.1vy8qtd2o2tt-68"><span class="c11">&nbsp; [scaled-width</span></p><p class="c3 subtitle" id="h.1vy8qtd2o2tt-69"><span class="c11">&nbsp; &nbsp;(inc (int (* (/ scaled-width image-width) image-height)))])</span></p><p class="c3 c17 subtitle" id="h.1vy8qtd2o2tt-70"><span class="c11"></span></p><p class="c3 subtitle" id="h.1vy8qtd2o2tt-71"><span class="c11">(defn get-thumbnail-maker</span></p><p class="c3 subtitle" id="h.1vy8qtd2o2tt-72"><span class="c11">&nbsp; [frame-grabber image-width image-height intended-width intended-height]</span></p><p class="c3 subtitle" id="h.1vy8qtd2o2tt-73"><span class="c11">&nbsp; (let [[image-width image-height] &nbsp; (frame-dimensions g)</span></p><p class="c3 subtitle" id="h.1vy8qtd2o2tt-74"><span class="c11">&nbsp; &nbsp; &nbsp; &nbsp; [scaled-width scaled-height] (scale-preserving-aspect-ratio image-width image-height scale-factor)]</span></p><p class="c3 subtitle" id="h.1vy8qtd2o2tt-75"><span class="c11">&nbsp; &nbsp; (. (FixedSizeThumbnailMaker. intended-width intended-height false true)</span></p><p class="c3 subtitle" id="h.1vy8qtd2o2tt-76"><span class="c11">&nbsp; &nbsp; &nbsp; &nbsp;resizer (get-resizer image-width image-height intended-width intended-height))))</span></p><p class="c3 c17 subtitle" id="h.1vy8qtd2o2tt-77"><span class="c11"></span></p><p class="c3 subtitle" id="h.1vy8qtd2o2tt-78"><span class="c11">(defn scale-image</span></p><p class="c3 subtitle" id="h.1vy8qtd2o2tt-79"><span class="c11">&nbsp; [thumbnail-maker buffered-image-to-scale]</span></p><p class="c3 subtitle" id="h.1vy8qtd2o2tt-80"><span class="c11">&nbsp; (. thumbnail-maker make buffered-image-to-scale))</span></p><p class="c5"><span class="c2"></span></p><p class="c8"><span class="c2">This methodology allows us to produce results such as this:</span></p><p class="c5"><span class="c2"></span></p><p class="c8"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 601.70px; height: 174.67px;"><img alt="" src="images/image17.png" style="width: 601.70px; height: 174.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c8"><span>This image, composed of frames from </span><span class="c12"><a class="c0" href="https://www.google.com/url?q=http://www.imdb.com/title/tt0062622/&amp;sa=D&amp;source=editors&amp;ust=1624292430895000&amp;usg=AOvVaw0HObt8a8eVopwSZzTGFGF7">2001: A Space Oddysey (1968)</a></span><span>,</span><span class="c2">&nbsp;highlights Kubrick&rsquo;s use of long static shots, indicated by the large stretches of regular colour.</span></p><p class="c5"><span class="c2"></span></p><p class="c8"><span>On the other hand, </span><span class="c12"><a class="c0" href="https://www.google.com/url?q=http://www.imdb.com/title/tt0133093/?ref_%3Dnv_sr_1&amp;sa=D&amp;source=editors&amp;ust=1624292430896000&amp;usg=AOvVaw0yZab-4Ha2PmXzwOWolUcz">The Matrix (1999)</a></span><span>&nbsp;is a great study in colour delineation, with scenes in the Matrix tinged with green (or white in the case of scenes set in The </span><span>Construct</span><span class="c2">), whereas scenes in the &lsquo;real world&rsquo; are coloured blue.</span></p><p class="c5"><span class="c2"></span></p><p class="c8"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 601.70px; height: 480.00px;"><img alt="" src="images/image10.png" style="width: 601.70px; height: 480.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c5"><span class="c2"></span></p><p class="c8"><span class="c2">Here are some other favourites, the interpretation of which I will leave as an exercise for the reader:</span></p><p class="c5"><span class="c2"></span></p><p class="c8"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 601.70px; height: 424.00px;"><img alt="" src="images/image32.png" style="width: 601.70px; height: 424.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c4"><span class="c12"><a class="c0" href="https://www.google.com/url?q=http://www.imdb.com/title/tt1104001/&amp;sa=D&amp;source=editors&amp;ust=1624292430898000&amp;usg=AOvVaw3PiLAGWZznnFlvxQNhsKii">Tron Legacy (2010)</a></span></p><p class="c4"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 601.70px; height: 434.67px;"><img alt="" src="images/image2.png" style="width: 601.70px; height: 434.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c4"><span class="c12"><a class="c0" href="https://www.google.com/url?q=http://www.imdb.com/title/tt0052357/?ref_%3Dnv_sr_6&amp;sa=D&amp;source=editors&amp;ust=1624292430899000&amp;usg=AOvVaw2y9y8jdDsydWm4CFJw6aAA">Vertigo (1958)</a></span></p><h2 class="c15" id="h.vng1luu7lubm"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 601.70px; height: 669.33px;"><img alt="" src="images/image3.png" style="width: 601.70px; height: 669.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></h2><p class="c4"><span class="c12"><a class="c0" href="https://www.google.com/url?q=http://www.imdb.com/title/tt0113568/&amp;sa=D&amp;source=editors&amp;ust=1624292430900000&amp;usg=AOvVaw1cfmd_x3jRtOrTdzHhz_uw">Ghost in the Shell (1995)</a></span></p><p class="c1"><span class="c2"></span></p><p class="c1"><span class="c2"></span></p><p class="c1"><span class="c2"></span></p><h2 class="c9" id="h.m5hda29gh42b"><span>N</span><span class="c6">ext Steps</span></h2><p class="c8"><span>Colour in films is rarely accidental. Filmmaking is an art form and</span><span>,</span><span>&nbsp;in most filmmaking, barring indie movements such as Dogme 95 (</span><span class="c12"><a class="c0" href="https://www.google.com/url?q=https://en.wikipedia.org/wiki/Dogme_95&amp;sa=D&amp;source=editors&amp;ust=1624292430901000&amp;usg=AOvVaw3D7SbjhHrFfsLKC6oNn1hQ">https://en.wikipedia.org/wiki/Dogme_95</a></span><span>), nothing in a shot is there by accident. Further, a director will choose a colour palette which they feel best conveys the most appropriate mood for a scene. Sometimes colours can be used to provide a clear delineation between ideas - a technique dating back to the &lsquo;black hat&rsquo; and &lsquo;white hat&rsquo; Westerns where hat colour differentiated the good guys from the bad guys (</span><span class="c12"><a class="c0" href="https://www.google.com/url?q=https://en.wikipedia.org/wiki/Black_and_white_hat_symbolism_in_film&amp;sa=D&amp;source=editors&amp;ust=1624292430901000&amp;usg=AOvVaw0AR84vBvGt_27uwA_hG8cH">https://en.wikipedia.org/wiki/Black_and_white_hat_symbolism_in_film</a></span><span>)</span><span>.</span></p><p class="c5"><span class="c2"></span></p><p class="c8"><span class="c2">Modern filmmaking has the advantage of being able to change the colours in a scene in post-production, allowing even more subtle manipulations of the audience&rsquo;s perceptions.</span></p><p class="c5"><span class="c2"></span></p><p class="c8"><span class="c2">As such, mining colour information for sentiment, tone or even genre is an interesting possibility. I hope to post a follow up exploring some or all of these areas.</span></p><h2 class="c9" id="h.csefq8pku8d2"><span class="c6">Results</span></h2><p class="c5"><span class="c2"></span></p><p class="c8"><span class="c12"><a class="c0" href="https://www.google.com/url?q=http://www.imdb.com/title/tt0241527/&amp;sa=D&amp;source=editors&amp;ust=1624292430903000&amp;usg=AOvVaw0k7WbKe-wX0WH1PXXiBBAR">Harry Potter and the Philosopher&#39;s Stone (2001)</a></span></p><p class="c8"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 601.70px; height: 420.00px;"><img alt="" src="images/image15.png" style="width: 601.70px; height: 420.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c5"><span class="c2"></span></p><p class="c5"><span class="c2"></span></p><p class="c5"><span class="c2"></span></p><p class="c8"><span class="c12"><a class="c0" href="https://www.google.com/url?q=http://www.imdb.com/title/tt0295297/&amp;sa=D&amp;source=editors&amp;ust=1624292430904000&amp;usg=AOvVaw0sWa-DdR1gb_CmVCDUW4ui">Harry Potter and the Chamber of Secrets (2002)</a></span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 601.70px; height: 461.33px;"><img alt="" src="images/image12.png" style="width: 601.70px; height: 461.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c5"><span class="c2"></span></p><p class="c8"><span class="c12"><a class="c0" href="https://www.google.com/url?q=http://www.imdb.com/title/tt0304141/&amp;sa=D&amp;source=editors&amp;ust=1624292430904000&amp;usg=AOvVaw2K_dW5-Yo5C9tB2fOaKVWd">Harry Potter and the Prisoner of Azkaban (2004)</a></span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 601.70px; height: 374.67px;"><img alt="" src="images/image30.png" style="width: 601.70px; height: 374.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c8"><span class="c12"><a class="c0" href="https://www.google.com/url?q=http://www.imdb.com/title/tt0330373/&amp;sa=D&amp;source=editors&amp;ust=1624292430904000&amp;usg=AOvVaw140YsSXefuh86ifQMR4KWp">Harry Potter and the Goblet of Fire (2005)</a></span></p><p class="c8"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 601.70px; height: 414.67px;"><img alt="" src="images/image23.png" style="width: 601.70px; height: 414.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c5"><span class="c2"></span></p><p class="c8"><span class="c12"><a class="c0" href="https://www.google.com/url?q=http://www.imdb.com/title/tt0373889/&amp;sa=D&amp;source=editors&amp;ust=1624292430905000&amp;usg=AOvVaw38-7FtExBpCWNDXez44b9I">Harry Potter and the Order of the Phoenix (2007)</a></span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 601.70px; height: 365.33px;"><img alt="" src="images/image24.png" style="width: 601.70px; height: 365.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c5"><span class="c2"></span></p><p class="c5"><span class="c2"></span></p><p class="c5"><span class="c2"></span></p><p class="c8"><span class="c12"><a class="c0" href="https://www.google.com/url?q=http://www.imdb.com/title/tt0417741/&amp;sa=D&amp;source=editors&amp;ust=1624292430906000&amp;usg=AOvVaw0bEVpnuWOIjwVN3KMZK1bB">Harry Potter and the Half-Blood Prince (2009)</a></span></p><p class="c8"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 601.70px; height: 405.33px;"><img alt="" src="images/image21.png" style="width: 601.70px; height: 405.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c5"><span class="c2"></span></p><p class="c8"><span class="c12"><a class="c0" href="https://www.google.com/url?q=http://www.imdb.com/title/tt0926084/&amp;sa=D&amp;source=editors&amp;ust=1624292430906000&amp;usg=AOvVaw1gA-aAPuYPseKlyAxLu1YA">Harry Potter and the Deathly Hallows Part 1 (2010)</a></span></p><p class="c8"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 601.70px; height: 385.33px;"><img alt="" src="images/image7.png" style="width: 601.70px; height: 385.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c5"><span class="c2"></span></p><p class="c5"><span class="c2"></span></p><p class="c5"><span class="c2"></span></p><p class="c8"><span class="c12"><a class="c0" href="https://www.google.com/url?q=http://www.imdb.com/title/tt1201607/&amp;sa=D&amp;source=editors&amp;ust=1624292430907000&amp;usg=AOvVaw0map68QpmmGuo3SQBFrfH7">Harry Potter and the Deathly Hallows Part 2 (2011)</a></span></p><p class="c8"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 601.50px; height: 344.71px;"><img alt="" src="images/image31.png" style="width: 601.50px; height: 344.71px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></body></html>